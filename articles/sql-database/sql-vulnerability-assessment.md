---
title: Evaluación de vulnerabilidad de SQL
description: Aprenda a configurar la Evaluación de vulnerabilidad de SQL en SQL Database y a interpretar los informes de evaluación.
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: DavidTrigano
ms.author: datrigan
ms.reviewer: vanto, carlrab
ms.date: 03/12/2019
ms.openlocfilehash: c0ceedad5e08165411657a8af79d28009851a17e
ms.sourcegitcommit: b07964632879a077b10f988aa33fa3907cbaaf0e
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 02/13/2020
ms.locfileid: "77190703"
---
# <a name="sql-vulnerability-assessment-service-helps-you-identify-database-vulnerabilities"></a>El servicio de evaluación de vulnerabilidad de SQL le ayuda a identificar los puntos vulnerables de la base de datos.

La Evaluación de vulnerabilidad de SQL es un servicio fácil de configurar que puede detectar, realizar un seguimiento y corregir posibles puntos vulnerables en la base de datos. Úsela para mejorar la seguridad de la base de datos de manera proactiva.

La evaluación de vulnerabilidades forma parte de la oferta de [Advanced Data Security (ADS)](sql-database-advanced-data-security.md), que es un paquete unificado para funcionalidades avanzadas de seguridad de SQL. Puede acceder a la evaluación de vulnerabilidad y administrarla a través del portal central de ADS de SQL.

> [!NOTE]
> Se admite la evaluación de vulnerabilidad para Azure SQL Database, instancia administrada de Azure SQL y Azure SQL Data Warehouse. Para simplificar, SQL Database se usa en este artículo cuando se hace referencia a cualquiera de estos servicios de base de datos administrados.

## <a name="the-vulnerability-assessment-service"></a>El servicio de evaluación de vulnerabilidad

Evaluación de vulnerabilidad de SQL (VA) es un servicio que proporciona visibilidad en el estado de seguridad e incluye pasos que requieren acción para resolver problemas de seguridad y mejorar la seguridad de la base de datos. En este sentido, le puede ayudar a:  

- Satisfacer los requisitos de cumplimiento que requieren los informes de examen de base de datos  
- Cumplir los estándares de privacidad de los datos  
- Supervisar un entorno de base de datos dinámico donde resulta difícil realizar un seguimiento de los cambios  

La evaluación de vulnerabilidad es un servicio de detección integrado en el servicio Azure SQL Database. El servicio emplea una base de reglas de conocimientos que marcan las vulnerabilidades de seguridad y resaltan las desviaciones con respecto a los procedimientos recomendados, como errores de configuración, permisos excesivos y datos confidenciales sin protección. Las reglas se basan en los procedimientos recomendados de Microsoft y se centran en los problemas de seguridad que presentan mayores riesgos para la base de datos y sus valiosos datos. Tratan los problemas de nivel de base de datos, así como los problemas de seguridad de nivel de servidor, como la configuración del firewall de servidor y los permisos de nivel de servidor. Estas reglas también representan muchos de los requisitos que deben cumplir diversos organismos reguladores para satisfacer los estándares de cumplimiento.  

Los resultados del examen incluyen pasos que requieren acción para corregir cada uno de los problemas y proporcionan scripts de solución personalizados donde sea aplicable. Es posible personalizar un informe de evaluación para su entorno estableciendo una línea de base aceptable para las configuraciones de permisos, configuraciones de características y configuración de base de datos.

## <a name="implementing-vulnerability-assessment"></a>Implementación de la evaluación de vulnerabilidad

En los pasos siguientes se implementa VA en SQL Database.  

### <a name="1-run-a-scan"></a>1. Ejecución de un examen  

Para empezar a usar VA, vaya a **Advanced Data Security** en el encabezado Seguridad del panel de su base de datos de Azure SQL. Haga clic para habilitar Advanced Data Security y, a continuación, haga clic en **Seleccionar almacenamiento** o en la tarjeta **Evaluación de vulnerabilidades**, que abre automáticamente la tarjeta de configuración de la evaluación de vulnerabilidades para todo SQL Server.

Empiece configurando una cuenta de almacenamiento en la que se almacenarán los resultados del examen de todas las bases de datos del servidor. Para más información sobre las cuentas de almacenamiento, vea [Acerca de las cuentas de almacenamiento de Azure](../storage/common/storage-create-storage-account.md). Una vez configurado el almacenamiento, haga clic en **Examinar** para examinar la base de datos en busca de vulnerabilidades.
  
![Examen de una base de datos](./media/sql-vulnerability-assessment/pp_va_initialize.png)  

  > [!NOTE]
  > El examen es ligero y seguro. Tarda unos segundos en ejecutarse y es completamente de lectura. No realiza ningún cambio en la base de datos.  

### <a name="2-view-the-report"></a>2. Visualización del informe

Una vez completado el examen, el informe del examen se muestra automáticamente en Azure Portal. El informe presenta una introducción del estado de seguridad: cuántos problemas se han detectado y sus respectivas gravedades. Los resultados incluyen advertencias sobre las desviaciones de los procedimientos recomendados, así como una instantánea de la configuración relacionada con la seguridad; por ejemplo, entidades de seguridad de bases de datos y roles, y sus permisos asociados. El informe de análisis también proporciona un mapa de datos confidenciales detectados en la base de datos, así como recomendaciones para clasificar datos mediante la [clasificación y detección de datos](sql-database-data-discovery-and-classification.md).

![Visualización del informe](./media/sql-vulnerability-assessment/pp_main_getstarted.png)  

### <a name="3-analyze-the-results-and-resolve-issues"></a>3. Análisis de resultados y solución de problemas

Revise los resultados y determine qué resultados del informe son, verdaderamente, problemas de seguridad en su entorno. Examine con detalle cada resultado erróneo para entender el impacto de la búsqueda y por qué se ha producido un error en las comprobaciones de seguridad. Use la información de corrección que requiere acción que se proporciona en el informe para resolver el problema.  

![Análisis del informe](./media/sql-vulnerability-assessment/pp_fail_rule_show_remediation.png)

### <a name="4-set-your-baseline"></a>4. Establecimiento de la línea base

Cuando revise los resultados de la evaluación, puede marcar los resultados específicos como una *línea de base* aceptable en su entorno. La línea de base es fundamentalmente una personalización de cómo se notifican los resultados. Los resultados que coinciden con la línea de base se consideran como correctos en análisis posteriores. Una vez que haya establecido el estado de seguridad de la línea de base, VA solo notifica desviaciones de la línea de base y puede centrar la atención en los problemas importantes.  

![Establecimiento de la línea base](./media/sql-vulnerability-assessment/pp_fail_rule_show_baseline.png)  

### <a name="5-run-a-new-scan-to-see-your-customized-tracking-report"></a>5. Ejecución de un nuevo examen para ver el informe de seguimiento personalizado

Después de completar la configuración de sus **líneas de base de la regla**, ejecute un examen nuevo para ver el informe personalizado. Ahora, VA informa solo de los problemas de seguridad que se desvían de la línea base aprobada.

![Visualización del informe personalizado](./media/sql-vulnerability-assessment/pp_pass_main_with_baselines.png)  

La evaluación de vulnerabilidad puede usarse ahora para supervisar que la base de datos mantenga un alto nivel de seguridad en todo momento y que se cumplan las directivas de la organización. Si se requieren informes de cumplimiento, los informes de Evaluación de vulnerabilidad pueden ser útiles para facilitar el proceso de cumplimiento.  

### <a name="6-set-up-periodic-recurring-scans"></a>6. Configuración de exámenes periódicos

Vaya a la opción Evaluación de vulnerabilidad para activar **Exámenes periódicos**. Se configurará la Evaluación de vulnerabilidad para ejecutar automáticamente un examen en la base de datos una vez por semana. Se enviará un resumen de resultados del examen a las direcciones de correo electrónico que proporcione.

![Visualización del informe personalizado](./media/sql-vulnerability-assessment/pp_recurring_scans.png)

### <a name="7-export-an-assessment-report"></a>7. Exportación de un informe de evaluación

Haga clic en **Exportar resultados del examen** para crear un informe de Excel del resultado del examen que se pueda descargar. Este informe contiene una pestaña de resumen que muestra un resumen de la evaluación, incluidas todas las comprobaciones con errores. También incluye una pestaña de **Resultados** que contiene el conjunto completo de resultados del examen, incluidas todas las comprobaciones ejecutadas y sus resultados detallados.

### <a name="8-view-scan-history"></a>8. Visualización del historial de exámenes

Haga clic en **Historial de exámenes** en el panel de VA para ver el historial de todos los exámenes ejecutados previamente en la base de datos. Seleccione un examen concreto en la lista para ver los resultados detallados del examen.

La evaluación de vulnerabilidad puede usarse ahora para supervisar que la base de datos mantenga un alto nivel de seguridad en todo momento y que se cumplan las directivas de la organización. Si se requieren informes de cumplimiento, los informes de Evaluación de vulnerabilidad pueden ser útiles para facilitar el proceso de cumplimiento.

## <a name="manage-vulnerability-assessments-using-azure-powershell"></a>Administrar las evaluaciones de vulnerabilidad con Azure PowerShell

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]
> [!IMPORTANT]
> El módulo de Azure Resource Manager para PowerShell todavía es compatible con Azure SQL Database, pero todo el desarrollo futuro se realizará para el módulo Az.Sql. Para estos cmdlets, consulte [AzureRM.Sql](https://docs.microsoft.com/powershell/module/AzureRM.Sql/). Los argumentos para los comandos del módulo Az y los módulos AzureRm son esencialmente idénticos.

Puede usar los cmdlets de Azure PowerShell para administrar mediante programación sus evaluaciones de vulnerabilidad. Los cmdlets compatibles son:

- [Update-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting)

  Actualiza la configuración de evaluación de vulnerabilidad de una base de datos.
- [Get-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting)

  Devuelve la configuración de evaluación de vulnerabilidad de una base de datos.
- [Clear-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting)

  Borra la configuración de evaluación de vulnerabilidad de una base de datos.
- [Set-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)

  Establece la base de referencia de la regla de evaluación de vulnerabilidad.
- [Get-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)

  Obtiene la base de referencia de una regla dada de evaluación de vulnerabilidad.
- [Clear-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)

  Borra la base de referencia de la regla de evaluación de vulnerabilidad. En primer lugar, establezca la línea base antes de usar este cmdlet para eliminarla.
- [Start-AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan)

  Desencadena el inicio de un examen de evaluación de vulnerabilidad.
- [Get-AzSqlDatabaseVulnerabilityAssessmentScanRecord](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord)

   Obtiene todos los registros de examen de evaluación de vulnerabilidad asociados con una base de datos dada.
- [Convert-AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan)

  Convierte los resultados del examen de evaluación de vulnerabilidad en un archivo de Excel.

Para obtener un ejemplo de script, consulte [Azure SQL Vulnerability Assessment PowerShell support](https://blogs.msdn.microsoft.com/sqlsecurity/20../../azure-sql-vulnerability-assessment-now-with-powershell-support/) (soporte técnico de PowerShell para la valoración de vulnerabilidades de Azure SQL).

## <a name="manage-vulnerability-assessments-baseline-rules-using-azure-resource-manager-templates"></a>Administración de reglas de línea de base de evaluación de vulnerabilidades mediante plantillas de Azure Resource Manager

Al configurar las líneas de base de evaluación de vulnerabilidades mediante plantillas de Azure Resource Manager, debe usar el tipo `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines`.

Asegúrese de que ha habilitado vulnerabilityAssements en SQL Server antes de agregar líneas de base.

Vea el ejemplo para definir la regla de línea de base VA2065 en masterdb y VA1143 en userdb como recursos en plantillas de ARM:

```json
    "resources": [
        {
            "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
            "apiVersion": "2018-06-01-preview",
            "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
            "properties": {
                "baselineResults": [
                    {
                        "result": [
                                "FirewallRuleName3",
                                "StartIpAddress",
                                "EndIpAddress"
                                  ]
                    },{
                         "result": [
                                "FirewallRuleName4",
                                "62.92.15.68",
                                "62.92.15.68"
                            ]
                        
                    }
                ]
            },
        {
            "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
            "apiVersion": "2018-06-01-preview",
            "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",
            "dependsOn": [
                "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
            ],
            "properties": {
                "baselineResults": [
                    {
                        "result": [
                            "dbo"
                        ]
                    }
                ]
            }
        }
    ]
}   
```

Para la base de datos de usuario y la base de datos maestra, los nombres de los recursos se definen de forma diferente:

* Base de datos maestra: "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/<b>master</b>')]",
* Base de datos de usuario: "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/<b>default</b>')]",
 
## <a name="next-steps"></a>Pasos siguientes  

- Más información sobre [Advanced Data Security](sql-database-advanced-data-security.md)
- Más información sobre la [clasificación y detección de datos](sql-database-data-discovery-and-classification.md)
